// ArkUIè‡ªå®šä¹‰ç»„ä»¶å’ŒBuilderæµ‹è¯•ç”¨ä¾‹
// æµ‹è¯•@Builderã€@Stylesã€@Extendè£…é¥°å™¨çš„å„ç§ç”¨æ³•

// å…¨å±€Builderå‡½æ•°
@Builder
function GlobalHeaderBuilder(title: string, subtitle: string) {
  Column() {
    Text(title)
      .fontSize(24)
      .fontWeight(FontWeight.Bold)
      .fontColor(Color.White)
      .textAlign(TextAlign.Center)
    
    if (subtitle) {
      Text(subtitle)
        .fontSize(14)
        .fontColor(Color.Gray)
        .textAlign(TextAlign.Center)
        .margin({ top: 5 })
    }
  }
  .width('100%')
  .padding(20)
  .backgroundColor(Color.Blue)
}

// å…¨å±€Styleså‡½æ•°
@Styles
function cardStyles() {
  .backgroundColor(Color.White)
  .borderRadius(12)
  .padding(16)
  .margin(8)
  .shadow({ 
    radius: 8, 
    color: '#20000000', 
    offsetX: 0, 
    offsetY: 2 
  })
}

@Styles
function buttonStyles() {
  .width(120)
  .height(40)
  .borderRadius(20)
  .fontColor(Color.White)
  .fontSize(14)
  .fontWeight(FontWeight.Bold)
}

// å…¨å±€Extendå‡½æ•°
@Extend(Text)
function fancyText(size: number, color: ResourceColor, weight: FontWeight) {
  .fontSize(size)
  .fontColor(color)
  .fontWeight(weight)
  .textAlign(TextAlign.Center)
  .padding(8)
  .borderRadius(4)
}

@Extend(Button)
function gradientButton(startColor: ResourceColor, endColor: ResourceColor) {
  .width(150)
  .height(45)
  .borderRadius(22)
  .fontColor(Color.White)
  .linearGradient({
    direction: GradientDirection.Right,
    colors: [[startColor, 0.0], [endColor, 1.0]]
  })
}

// ä¸»ç»„ä»¶
@Component
struct CustomBuilderTest {
  @State currentTab: number = 0
  @State itemList: string[] = ['é¡¹ç›®1', 'é¡¹ç›®2', 'é¡¹ç›®3']
  @State selectedItems: boolean[] = [false, false, false]

  // æœ¬åœ°Builderæ–¹æ³• - ç®€å•Builder
  @Builder
  simpleCardBuilder(title: string, content: string) {
    Column() {
      Text(title)
        .fancyText(16, Color.Black, FontWeight.Bold)
        .width('100%')
        .backgroundColor('#f0f0f0')
        .margin({ bottom: 8 })
      
      Text(content)
        .fontSize(14)
        .fontColor(Color.Gray)
        .textAlign(TextAlign.Start)
        .width('100%')
    }
    .cardStyles()
    .alignItems(HorizontalAlign.Start)
  }

  // æœ¬åœ°Builderæ–¹æ³• - å¸¦å‚æ•°çš„å¤æ‚Builder
  @Builder
  listItemBuilder(item: string, index: number, isSelected: boolean) {
    Row() {
      Checkbox({ name: `checkbox_${index}`, group: 'itemGroup' })
        .select(isSelected)
        .selectedColor(Color.Blue)
        .onChange((value: boolean) => {
          this.selectedItems[index] = value
        })
      
      Text(item)
        .fontSize(16)
        .flexGrow(1)
        .margin({ left: 12 })
        .fontColor(isSelected ? Color.Blue : Color.Black)
      
      Button('ç¼–è¾‘')
        .fontSize(12)
        .backgroundColor(Color.Orange)
        .width(60)
        .height(30)
        .onClick(() => {
          console.log(`ç¼–è¾‘é¡¹ç›®: ${item}`)
        })
    }
    .width('100%')
    .padding(12)
    .backgroundColor(isSelected ? '#e6f3ff' : Color.White)
    .borderRadius(8)
    .border({ 
      width: isSelected ? 2 : 1, 
      color: isSelected ? Color.Blue : Color.Gray 
    })
    .margin({ bottom: 8 })
    .alignItems(VerticalAlign.Center)
  }

  // æœ¬åœ°Builderæ–¹æ³• - æ ‡ç­¾é¡µBuilder
  @Builder
  tabBuilder(title: string, index: number, icon: string) {
    Column() {
      Text(icon)
        .fontSize(20)
        .margin({ bottom: 4 })
      
      Text(title)
        .fontSize(12)
        .fontColor(this.currentTab === index ? Color.Blue : Color.Gray)
    }
    .width(80)
    .height(60)
    .justifyContent(FlexAlign.Center)
    .backgroundColor(this.currentTab === index ? '#e6f3ff' : Color.Transparent)
    .borderRadius(8)
    .onClick(() => {
      this.currentTab = index
    })
  }

  // æœ¬åœ°Builderæ–¹æ³• - åŠ¨æ€å†…å®¹Builder
  @Builder
  dynamicContentBuilder() {
    Column() {
      if (this.currentTab === 0) {
        // é¦–é¡µå†…å®¹
        this.simpleCardBuilder('æ¬¢è¿ä½¿ç”¨', 'è¿™æ˜¯é¦–é¡µçš„å†…å®¹åŒºåŸŸ')
        
        Row() {
          Button('ä¸»è¦æ“ä½œ')
            .gradientButton(Color.Blue, Color.Purple)
          
          Button('æ¬¡è¦æ“ä½œ')
            .buttonStyles()
            .backgroundColor(Color.Gray)
        }
        .width('100%')
        .justifyContent(FlexAlign.SpaceEvenly)
        .margin({ top: 20 })
        
      } else if (this.currentTab === 1) {
        // åˆ—è¡¨å†…å®¹
        Text('é¡¹ç›®åˆ—è¡¨')
          .fancyText(18, Color.Black, FontWeight.Bold)
          .width('100%')
          .margin({ bottom: 15 })
        
        ForEach(this.itemList, (item: string, index: number) => {
          this.listItemBuilder(item, index, this.selectedItems[index])
        }, (item: string, index: number) => `${index}_${item}`)
        
        Row() {
          Button('å…¨é€‰')
            .buttonStyles()
            .backgroundColor(Color.Green)
            .onClick(() => {
              this.selectedItems = this.selectedItems.map(() => true)
            })
          
          Button('å–æ¶ˆå…¨é€‰')
            .buttonStyles()
            .backgroundColor(Color.Red)
            .onClick(() => {
              this.selectedItems = this.selectedItems.map(() => false)
            })
        }
        .width('100%')
        .justifyContent(FlexAlign.SpaceEvenly)
        .margin({ top: 15 })
        
      } else {
        // è®¾ç½®å†…å®¹
        this.simpleCardBuilder('è®¾ç½®é€‰é¡¹', 'è¿™é‡Œæ˜¯åº”ç”¨çš„å„ç§è®¾ç½®')
        
        Column() {
          this.settingItemBuilder('é€šçŸ¥è®¾ç½®', 'ç®¡ç†åº”ç”¨é€šçŸ¥', true)
          this.settingItemBuilder('éšç§è®¾ç½®', 'ä¿æŠ¤æ‚¨çš„éšç§', false)
          this.settingItemBuilder('è´¦æˆ·è®¾ç½®', 'ç®¡ç†æ‚¨çš„è´¦æˆ·', true)
        }
        .width('100%')
      }
    }
    .width('100%')
    .alignItems(HorizontalAlign.Start)
  }

  // æœ¬åœ°Builderæ–¹æ³• - è®¾ç½®é¡¹Builder
  @Builder
  settingItemBuilder(title: string, description: string, hasSwitch: boolean) {
    Row() {
      Column() {
        Text(title)
          .fontSize(16)
          .fontWeight(FontWeight.Bold)
          .textAlign(TextAlign.Start)
        
        Text(description)
          .fontSize(12)
          .fontColor(Color.Gray)
          .textAlign(TextAlign.Start)
          .margin({ top: 2 })
      }
      .flexGrow(1)
      .alignItems(HorizontalAlign.Start)
      
      if (hasSwitch) {
        Toggle({ type: ToggleType.Switch, isOn: false })
          .selectedColor(Color.Blue)
          .switchPointColor(Color.White)
      } else {
        Text('>')
          .fontSize(16)
          .fontColor(Color.Gray)
      }
    }
    .width('100%')
    .padding(15)
    .backgroundColor(Color.White)
    .borderRadius(8)
    .margin({ bottom: 8 })
    .alignItems(VerticalAlign.Center)
  }

  // æœ¬åœ°Stylesæ–¹æ³•
  @Styles
  tabBarStyles() {
    .width('100%')
    .height(70)
    .backgroundColor(Color.White)
    .border({ 
      width: { top: 1 }, 
      color: Color.Gray 
    })
  }

  build() {
    Column() {
      // ä½¿ç”¨å…¨å±€Builder
      GlobalHeaderBuilder('è‡ªå®šä¹‰ç»„ä»¶æµ‹è¯•', 'Builderã€Stylesã€Extendç¤ºä¾‹')
      
      // ä¸»å†…å®¹åŒºåŸŸ
      Column() {
        this.dynamicContentBuilder()
      }
      .width('100%')
      .layoutWeight(1)
      .padding(15)
      .backgroundColor('#f5f5f5')
      
      // åº•éƒ¨æ ‡ç­¾æ 
      Row() {
        this.tabBuilder('é¦–é¡µ', 0, 'ğŸ ')
        this.tabBuilder('åˆ—è¡¨', 1, 'ğŸ“‹')
        this.tabBuilder('è®¾ç½®', 2, 'âš™ï¸')
      }
      .tabBarStyles()
      .justifyContent(FlexAlign.SpaceEvenly)
      .alignItems(VerticalAlign.Center)
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#f8f8f8')
  }
}

// å¯å¤ç”¨çš„è‡ªå®šä¹‰ç»„ä»¶ï¼Œæ¼”ç¤º@Builderçš„é«˜çº§ç”¨æ³•
@Component
struct ReusableCard {
  @Prop title: string = ''
  @Prop subtitle: string = ''
  @Prop showActions: boolean = true
  @Builder customContent: () => void = this.defaultContent

  @Builder
  defaultContent() {
    Text('é»˜è®¤å†…å®¹')
      .fontSize(14)
      .fontColor(Color.Gray)
  }

  @Builder
  actionButtons() {
    Row() {
      Button('ç¡®è®¤')
        .buttonStyles()
        .backgroundColor(Color.Green)
      
      Button('å–æ¶ˆ')
        .buttonStyles()
        .backgroundColor(Color.Red)
        .margin({ left: 10 })
    }
    .width('100%')
    .justifyContent(FlexAlign.End)
    .margin({ top: 15 })
  }

  build() {
    Column() {
      // æ ‡é¢˜åŒºåŸŸ
      if (this.title) {
        Text(this.title)
          .fancyText(18, Color.Black, FontWeight.Bold)
          .width('100%')
        
        if (this.subtitle) {
          Text(this.subtitle)
            .fontSize(12)
            .fontColor(Color.Gray)
            .width('100%')
            .textAlign(TextAlign.Start)
            .margin({ top: 4 })
        }
        
        Divider()
          .height(1)
          .color(Color.Gray)
          .margin({ top: 10, bottom: 10 })
      }
      
      // è‡ªå®šä¹‰å†…å®¹åŒºåŸŸ
      this.customContent()
      
      // æ“ä½œæŒ‰é’®åŒºåŸŸ
      if (this.showActions) {
        this.actionButtons()
      }
    }
    .cardStyles()
    .alignItems(HorizontalAlign.Start)
  }
}