// ArkUIäº‹ä»¶å¤„ç†å’Œæ•°æ®ç»‘å®šæµ‹è¯•ç”¨ä¾‹
// æµ‹è¯•å„ç§äº‹ä»¶å›žè°ƒã€æ‰‹åŠ¿è¯†åˆ«ã€æ•°æ®ç»‘å®šç­‰

import { promptAction } from '@kit.ArkUI'

// äº‹ä»¶æ•°æ®æ¨¡åž‹
@Observed
class EventData {
  clickCount: number = 0
  lastEventType: string = ''
  lastEventTime: string = ''
  gestureInfo: string = ''
  
  updateEvent(type: string) {
    this.lastEventType = type
    this.lastEventTime = new Date().toLocaleTimeString()
    if (type === 'click') {
      this.clickCount++
    }
  }
}

// ä¸»äº‹ä»¶æµ‹è¯•ç»„ä»¶
@Component
struct EventHandlingTest {
  @State eventData: EventData = new EventData()
  @State currentValue: number = 0
  @State inputText: string = ''
  @State selectedColor: Color = Color.Blue
  @State dragOffset: Position = { x: 0, y: 0 }
  @State scaleValue: number = 1
  @State rotateAngle: number = 0

  // åŸºç¡€ç‚¹å‡»äº‹ä»¶å¤„ç†
  private handleBasicClick(eventType: string) {
    this.eventData.updateEvent(eventType)
    console.log(`äº‹ä»¶è§¦å‘: ${eventType}`)
  }

  // é•¿æŒ‰äº‹ä»¶å¤„ç†
  private handleLongPress() {
    this.eventData.updateEvent('longpress')
    promptAction.showToast({
      message: 'é•¿æŒ‰äº‹ä»¶è§¦å‘',
      duration: 2000
    })
  }

  // åŒå‡»äº‹ä»¶å¤„ç†
  private handleDoubleClick() {
    this.eventData.updateEvent('doubleclick')
    this.selectedColor = this.selectedColor === Color.Blue ? Color.Red : Color.Blue
  }

  // æ‹–æ‹½äº‹ä»¶å¤„ç†
  private handleDrag(event: DragEvent) {
    this.dragOffset.x = event.getX()
    this.dragOffset.y = event.getY()
    this.eventData.gestureInfo = `æ‹–æ‹½ä½ç½®: (${Math.round(this.dragOffset.x)}, ${Math.round(this.dragOffset.y)})`
  }

  // æ‰‹åŠ¿äº‹ä»¶å¤„ç†
  private handlePinchGesture(event: GestureEvent) {
    if (event.scale) {
      this.scaleValue = event.scale
      this.eventData.gestureInfo = `ç¼©æ”¾å€æ•°: ${this.scaleValue.toFixed(2)}`
    }
  }

  private handleRotateGesture(event: GestureEvent) {
    if (event.angle) {
      this.rotateAngle = event.angle
      this.eventData.gestureInfo = `æ—‹è½¬è§’åº¦: ${this.rotateAngle.toFixed(1)}Â°`
    }
  }

  build() {
    Scroll() {
      Column({ space: 15 }) {
        // æ ‡é¢˜å’Œäº‹ä»¶çŠ¶æ€æ˜¾ç¤º
        Text('ArkUIäº‹ä»¶å¤„ç†æµ‹è¯•')
          .fontSize(24)
          .fontWeight(FontWeight.Bold)
          .textAlign(TextAlign.Center)
          .width('100%')

        // äº‹ä»¶çŠ¶æ€æ˜¾ç¤ºå¡ç‰‡
        Column() {
          Text('äº‹ä»¶çŠ¶æ€')
            .fontSize(18)
            .fontWeight(FontWeight.Bold)
            .margin({ bottom: 10 })

          Text(`ç‚¹å‡»æ¬¡æ•°: ${this.eventData.clickCount}`)
            .fontSize(14)
            .margin({ bottom: 5 })

          Text(`æœ€åŽäº‹ä»¶: ${this.eventData.lastEventType}`)
            .fontSize(14)
            .margin({ bottom: 5 })

          Text(`äº‹ä»¶æ—¶é—´: ${this.eventData.lastEventTime}`)
            .fontSize(14)
            .margin({ bottom: 5 })

          Text(`æ‰‹åŠ¿ä¿¡æ¯: ${this.eventData.gestureInfo}`)
            .fontSize(14)
            .fontColor(Color.Blue)
        }
        .width('100%')
        .padding(15)
        .backgroundColor('#f0f0f0')
        .borderRadius(8)

        // åŸºç¡€ç‚¹å‡»äº‹ä»¶æµ‹è¯•
        Text('åŸºç¡€ç‚¹å‡»äº‹ä»¶')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)

        Row() {
          Button('å•å‡»')
            .backgroundColor(Color.Blue)
            .onClick(() => {
              this.handleBasicClick('click')
            })

          Button('åŒå‡»')
            .backgroundColor(Color.Green)
            .gesture(
              TapGesture({ count: 2 })
                .onAction(() => {
                  this.handleDoubleClick()
                })
            )

          Button('é•¿æŒ‰')
            .backgroundColor(Color.Orange)
            .gesture(
              LongPressGesture({ repeat: true })
                .onAction(() => {
                  this.handleLongPress()
                })
            )
        }
        .width('100%')
        .justifyContent(FlexAlign.SpaceEvenly)

        // é¼ æ ‡äº‹ä»¶æµ‹è¯•
        Text('é¼ æ ‡äº‹ä»¶')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)

        Text('é¼ æ ‡äº¤äº’åŒºåŸŸ')
          .fontSize(16)
          .textAlign(TextAlign.Center)
          .width(200)
          .height(80)
          .backgroundColor(this.selectedColor)
          .fontColor(Color.White)
          .borderRadius(8)
          .alignSelf(ItemAlign.Center)
          .onMouse((event: MouseEvent) => {
            if (event.action === MouseAction.Press) {
              this.eventData.updateEvent('mousedown')
            } else if (event.action === MouseAction.Release) {
              this.eventData.updateEvent('mouseup')
            }
          })
          .onHover((isHover: boolean) => {
            if (isHover) {
              this.eventData.updateEvent('mouseenter')
            } else {
              this.eventData.updateEvent('mouseleave')
            }
          })

        // è§¦æ‘¸äº‹ä»¶æµ‹è¯•
        Text('è§¦æ‘¸äº‹ä»¶')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)

        Text('è§¦æ‘¸åŒºåŸŸ')
          .fontSize(16)
          .textAlign(TextAlign.Center)
          .width(200)
          .height(80)
          .backgroundColor(Color.Purple)
          .fontColor(Color.White)
          .borderRadius(8)
          .alignSelf(ItemAlign.Center)
          .onTouch((event: TouchEvent) => {
            if (event.type === TouchType.Down) {
              this.eventData.updateEvent('touchdown')
            } else if (event.type === TouchType.Up) {
              this.eventData.updateEvent('touchup')
            } else if (event.type === TouchType.Move) {
              this.eventData.updateEvent('touchmove')
            }
          })

        // æ‹–æ‹½äº‹ä»¶æµ‹è¯•
        Text('æ‹–æ‹½äº‹ä»¶')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)

        Text('æ‹–æ‹½æˆ‘')
          .fontSize(16)
          .textAlign(TextAlign.Center)
          .width(120)
          .height(60)
          .backgroundColor(Color.Red)
          .fontColor(Color.White)
          .borderRadius(8)
          .translate({ x: this.dragOffset.x / 10, y: this.dragOffset.y / 10 })
          .animation({
            duration: 200,
            curve: Curve.Linear
          })
          .gesture(
            PanGesture()
              .onActionStart((event: GestureEvent) => {
                this.eventData.updateEvent('dragstart')
              })
              .onActionUpdate((event: GestureEvent) => {
                this.dragOffset.x = event.offsetX
                this.dragOffset.y = event.offsetY
                this.eventData.gestureInfo = `æ‹–æ‹½åç§»: (${Math.round(this.dragOffset.x)}, ${Math.round(this.dragOffset.y)})`
              })
              .onActionEnd(() => {
                this.eventData.updateEvent('dragend')
              })
          )

        // æ‰‹åŠ¿è¯†åˆ«æµ‹è¯•
        Text('æ‰‹åŠ¿è¯†åˆ«')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)

        Text('ðŸŽ¯')
          .fontSize(60)
          .textAlign(TextAlign.Center)
          .width(150)
          .height(150)
          .backgroundColor('#ffe6e6')
          .borderRadius(75)
          .alignSelf(ItemAlign.Center)
          .scale({ x: this.scaleValue, y: this.scaleValue })
          .rotate({ angle: this.rotateAngle })
          .animation({
            duration: 100,
            curve: Curve.Linear
          })
          .parallelGesture(
            PinchGesture()
              .onActionUpdate((event: GestureEvent) => {
                this.handlePinchGesture(event)
              })
          )
          .parallelGesture(
            RotationGesture()
              .onActionUpdate((event: GestureEvent) => {
                this.handleRotateGesture(event)
              })
          )
          .gesture(
            SwipeGesture({ direction: SwipeDirection.All })
              .onAction((event: GestureEvent) => {
                this.eventData.updateEvent('swipe')
                this.eventData.gestureInfo = `æ»‘åŠ¨æ–¹å‘: ${event.angle}Â°`
              })
          )

        // è¡¨å•æŽ§ä»¶äº‹ä»¶æµ‹è¯•
        Text('è¡¨å•æŽ§ä»¶äº‹ä»¶')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)

        Column() {
          TextInput({ 
            placeholder: 'è¾“å…¥æ–‡æœ¬è§¦å‘äº‹ä»¶', 
            text: this.inputText 
          })
            .width('100%')
            .margin({ bottom: 10 })
            .onChange((value: string) => {
              this.inputText = value
              this.eventData.updateEvent('textchange')
            })
            .onFocus(() => {
              this.eventData.updateEvent('focus')
            })
            .onBlur(() => {
              this.eventData.updateEvent('blur')
            })
            .onSubmit(() => {
              this.eventData.updateEvent('submit')
            })

          Slider({
            value: this.currentValue,
            min: 0,
            max: 100,
            step: 1
          })
            .width('100%')
            .margin({ bottom: 10 })
            .onChange((value: number, mode: SliderChangeMode) => {
              this.currentValue = value
              this.eventData.updateEvent('slidechange')
              this.eventData.gestureInfo = `æ»‘å—å€¼: ${value}`
            })

          Toggle({ 
            type: ToggleType.Switch, 
            isOn: false 
          })
            .onChange((isOn: boolean) => {
              this.eventData.updateEvent('togglechange')
              this.eventData.gestureInfo = `å¼€å…³çŠ¶æ€: ${isOn ? 'å¼€' : 'å…³'}`
            })

          Button('é‡ç½®æ‰€æœ‰çŠ¶æ€')
            .width('100%')
            .backgroundColor(Color.Gray)
            .margin({ top: 15 })
            .onClick(() => {
              this.eventData = new EventData()
              this.currentValue = 0
              this.inputText = ''
              this.selectedColor = Color.Blue
              this.dragOffset = { x: 0, y: 0 }
              this.scaleValue = 1
              this.rotateAngle = 0
            })
        }
        .width('100%')
        .padding(15)
        .backgroundColor(Color.White)
        .borderRadius(8)

        // é”®ç›˜äº‹ä»¶æµ‹è¯•
        Text('é”®ç›˜äº‹ä»¶')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)

        TextArea({ 
          placeholder: 'åœ¨æ­¤è¾“å…¥ä»¥æµ‹è¯•é”®ç›˜äº‹ä»¶...',
          text: this.inputText
        })
          .width('100%')
          .height(100)
          .backgroundColor(Color.White)
          .borderRadius(8)
          .padding(10)
          .onChange((value: string) => {
            this.inputText = value
          })
          .onKeyEvent((event: KeyEvent) => {
            if (event.type === KeyType.Down) {
              this.eventData.updateEvent('keydown')
              this.eventData.gestureInfo = `æŒ‰é”®: ${event.keyCode}`
            }
          })

        // ç„¦ç‚¹äº‹ä»¶æµ‹è¯•
        Text('ç„¦ç‚¹äº‹ä»¶')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)

        Row() {
          Button('ç„¦ç‚¹1')
            .backgroundColor(Color.Cyan)
            .focusable(true)
            .onFocus(() => {
              this.eventData.updateEvent('button1_focus')
            })
            .onBlur(() => {
              this.eventData.updateEvent('button1_blur')
            })

          Button('ç„¦ç‚¹2')
            .backgroundColor(Color.Pink)
            .focusable(true)
            .onFocus(() => {
              this.eventData.updateEvent('button2_focus')
            })
            .onBlur(() => {
              this.eventData.updateEvent('button2_blur')
            })
        }
        .width('100%')
        .justifyContent(FlexAlign.SpaceEvenly)

        // ç»„åˆæ‰‹åŠ¿æµ‹è¯•
        Text('ç»„åˆæ‰‹åŠ¿')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)

        Text('ðŸ‘‹')
          .fontSize(50)
          .textAlign(TextAlign.Center)
          .width(120)
          .height(120)
          .backgroundColor('#e6f3ff')
          .borderRadius(60)
          .alignSelf(ItemAlign.Center)
          .priorityGesture(
            GestureGroup(GestureMode.Parallel,
              TapGesture({ count: 2 })
                .onAction(() => {
                  this.eventData.updateEvent('doubletap')
                  this.selectedColor = Color.Random
                }),
              LongPressGesture({ repeat: false, duration: 500 })
                .onAction(() => {
                  this.eventData.updateEvent('longpress_combined')
                })
            )
          )
      }
      .width('100%')
      .padding(20)
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#f8f8f8')
  }
}